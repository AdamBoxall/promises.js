function when(e){function i(e){e(this.resolve.bind(this))}function s(e){var i=t.indexOf(e);if(i!==-1){n.push(t.splice(i,1)[0]);if(t.length===0){r()}}}var t=[];var n=[];var r;i.prototype={resolve:function(){if(this.notify){this.notify(this)}},subscribe:function(e){this.notify=e;return this}};if(typeof e==="function"){e=[e]}e.forEach(function(e){t.push((new i(e)).subscribe(s))});return{done:function(e){r=e}}}